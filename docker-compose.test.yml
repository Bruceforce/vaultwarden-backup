---
version: '3.7'
services:
  vaultwarden:
    image: vaultwarden/server
    container_name: vaultwarden
    user: 1000:1000
    ports:
      - 8002:8080
    volumes:
      - ./vw-data/:/data/
    restart: on-failure
    environment:
      - ROCKET_PORT=8080

  vaultwarden-backup:
    container_name: vaultwarden-backup
    build: .
    #user: 1000:1000
    restart: always
    init: true
    depends_on:
      - vaultwarden
    volumes:
      - ./vw-data:/data/
      - ./test:/backup
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    environment:
      - BACKUP_ADD_DATABASE=true
      - BACKUP_ADD_ATTACHMENTS=true
      - BACKUP_ADD_CONFIG_JSON=true
      - DELETE_AFTER=1
      - TIMESTAMP=true
      - CRON_TIME=*/1 * * * *
      - TZ=Europe/Berlin
      - UID=1000
      - GID=1000
      - BACKUP_DIR=/backup
      #- BACKUP_DIR_PERMISSIONS=777
      #- BACKUP_DIR_PERMISSIONS=-1
      #- LOG_DIR_PERMISSIONS=-1
      - LOG_DIR=/backup/logs
      - LOG_LEVEL=DEBUG
      - BACKUP_ON_STARTUP=true


